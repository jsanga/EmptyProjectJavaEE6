<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                template="/admin/principal.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core">
    

    <ui:define name="content">
        <h:form id="frmMain">
            <p:growl autoUpdate="true" showDetail="true" sticky="true"/>
            <center>
                <h:outputText id="titulo" value="Estudiantes" style="font-weight:bold; font-size: 32px; font-family: inherit;"/>
            </center>
            <p:commandButton value="Ingresar Estudiante" update="dlgForm" actionListener="#{estudianteView.nuevoEstudiante()}" icon="ui-icon-circle-arrow-e" onclick="PF('dlgCrear').show()" style="margin-top: 15px; margin-bottom: 15px;"/>
            <center>
                <p:dataTable id="dtEstudiantesList" value="#{estudianteView.personasList}" lazy="true" emptyMessage="No tiene datos" 
                             var="persona" rows="10" paginator="true" style="margin-bottom: 15px;">
                    <f:facet name="header">
                        Lista de estudiantes
                    </f:facet>
                    <p:column headerText="Cédula" filterBy="#{persona.cedula}" width="10%">
                        <h:outputText value="#{persona.cedula}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Nombres" filterBy="#{persona.nombres}" width="20%">
                        <h:outputText value="#{persona.nombres}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Apellidos" filterBy="#{persona.apellidos}" width="20%">
                        <h:outputText value="#{persona.apellidos}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Estado" width="10%">
                        <h:outputText value="Activo" rendered="#{persona.estado}" style="text-transform: uppercase;"/>
                        <h:outputText value="Inactivo" rendered="#{!persona.estado}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Acción" width="20%">
                        <center>
                            <p:commandButton value="Editar" actionListener="#{estudianteView.editarEstudiante(persona)}" onclick="PF('dlgEditar').show()" update="dlgFormEdit" icon="ui-icon-pencil"/>
                            <p:commandButton value="Eliminar" actionListener="#{estudianteView.eliminarEstudiante(persona)}" update="dtEstudiantesList" icon="ui-icon-circle-close"/>
                            <p:commandButton value="Más información" actionListener="#{estudianteView.verMasDatos(persona)}" update="dtEstudiantesList" icon="ui-icon-zoomout"/>
                        </center>
                    </p:column>
                </p:dataTable>
            </center>
        </h:form>
        
        <p:dialog header="Crear Estudiante" id="dlgCrear" widgetVar="dlgCrear" modal="true" height="auto" width="auto" resizable="false">  
            <h:form id="dlgForm" >
                <p:panelGrid columns="3" style="width: 100%;">
                    <h:outputText value="Cédula:"/>
                    <p:inputText value="#{estudianteView.cedula}" style="text-transform: uppercase; width: 100%;"/>
                    <p:commandButton value="Buscar" actionListener="#{estudianteView.buscarPersona()}" update="dtEstudiantes"/>
                </p:panelGrid>
                <p:dataTable id="dtEstudiantes" value="#{estudianteView.personasEncontradasList}" emptyMessage="No hay datos" style="width: 487px;" var="persona">
                    <p:column headerText="Nombres" >
                    <h:outputText value="#{persona.nombres}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Apellidos" >
                        <h:outputText value="#{persona.apellidos}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Estado">
                        <h:outputText value="Activo" rendered="#{persona.estado}" style="text-transform: uppercase;"/>
                        <h:outputText value="Inactivo" rendered="#{!persona.estado}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Rol">
                        <h:outputText value="#{persona.rol.rolName}" rendered="#{persona.rol!=null}" style="text-transform: uppercase;"/>
                        <h:outputText value="No tiene" rendered="#{persona.rol==null}" style="text-transform: uppercase;"/>
                    </p:column>
                    <p:column headerText="Acción">
                        <p:commandButton value="Seleccionar" disabled="#{!persona.estado}" update="dlgForm" onclick="PF('dlgConfirm').show()" oncomplete="PF('dlgCrear').hide()" actionListener="#{estudianteView.setPersonaTemp(persona)}" style="text-transform: uppercase;" icon="ui-icon-carat-1-e"/>
                    </p:column>
                </p:dataTable>
                    
                <center><p:commandButton value="Salir" onclick="PF('dlgCrear').hide()" update=":frmMain"/></center>
            </h:form>
        </p:dialog>
        
        <p:dialog header="Editar Estudiante" id="dlgEditar" widgetVar="dlgEditar" modal="true" height="auto" width="auto" resizable="false">  
            <h:form id="dlgFormEdit" >
                <p:tabView>
                    <p:tab title="Datos personales">
                        <p:panelGrid columns="2">
                            <h:outputText value="Nombres:"/>
                            <p:inputText value="#{estudianteView.persona.nombres}" style="text-transform: uppercase;"/>
                            <h:outputText value="Apellidos:"/>
                            <p:inputText value="#{estudianteView.persona.apellidos}" style="text-transform: uppercase;"/>
                            <h:outputText value="Dirección:"/>
                            <p:inputText value="#{estudianteView.persona.direccion}" style="text-transform: uppercase;"/>
                            <h:outputText value="Fecha de Nacimiento:"/>
                            <p:calendar value="#{estudianteView.persona.fechaNacimiento}" navigator="true"/>
                            <h:outputText value="Colegio:"/>
                            <p:selectOneMenu value="#{estudianteView.colegio}" converter="colegioConverter" style="width: 180px;">
                                <f:selectItem itemLabel="Seleccionar" itemValue="#{null}" />
                                <f:selectItems value="#{estudianteView.colegios}" var="col" itemValue="#{col}" itemLabel="#{col.nombre}"/>
                            </p:selectOneMenu>
                        </p:panelGrid>
                        <center><p:commandButton value="Terminar Edición" actionListener="#{estudianteView.guardarEdicion()}" onclick="PF('dlgEditar').hide()" update=":frmMain" icon="ui-icon-check"/></center>
                    </p:tab>
                    <p:tab title="Agregar relación personal">
                        <p:panelGrid columns="3" style="width: 100%;">
                            <h:outputText value="Cédula:"/>
                            <p:inputText value="#{estudianteView.cedula}" style="text-transform: uppercase;"/>
                            <p:commandButton value="Buscar" actionListener="#{estudianteView.buscarPersona()}" update="dlgFormEdit"/>
                        </p:panelGrid>
                        <p:dataTable id="dtRelacion" value="#{estudianteView.personasEncontradasList}" emptyMessage="No tiene datos" style="width: 487px;" var="persona">
                            <p:column headerText="Nombres" >
                            <h:outputText value="#{persona.nombres}" style="text-transform: uppercase;"/>
                            </p:column>
                            <p:column headerText="Apellidos" >
                                <h:outputText value="#{persona.apellidos}" style="text-transform: uppercase;"/>
                            </p:column>
                            <p:column headerText="Estado" >
                                <h:outputText value="Activo" rendered="#{persona.estado}" style="text-transform: uppercase;"/>
                                <h:outputText value="Inactivo" rendered="#{!persona.estado}" style="text-transform: uppercase;"/>
                            </p:column>
                            
                            <p:column headerText="Acción">
                                <p:commandButton value="Seleccionar" disabled="#{!persona.estado}" update="dlgForm" actionListener="#{estudianteView.agregarRelacion(persona)}" style="text-transform: uppercase;" icon="ui-icon-carat-1-e"/>
                            </p:column>
                        </p:dataTable>
                        <p:panel header="Tipo de relación" >
                            <p:selectOneMenu disabled="#{estudianteView.personasEncontradasList==null}" value="#{estudianteView.tipoRelacion}" converter="tipoRelacionConverter" style="width: 180px;">
                                <f:selectItem itemLabel="Seleccionar" itemValue="#{null}" />
                                <f:selectItems value="#{estudianteView.tipoRelacionList}" var="col" itemValue="#{col}" itemLabel="#{col.nombreRelacion}"/>
                            </p:selectOneMenu>
                        </p:panel>
                    </p:tab>
                </p:tabView>
                
            </h:form>
        </p:dialog>
        
        <p:dialog header="Confirmación" id="dlgConfirm" widgetVar="dlgConfirm" modal="true" height="auto" width="auto" resizable="false">  
            <h:form id="dlgFrmConfirm" >
                <h:outputText value="Está seguro de que desea asignarle el rol de estudiante?"/>
                <h:panelGroup>
                    <center>
                        <p:commandButton value="Sí" actionListener="#{estudianteView.asignarRolEst}" oncomplete="PF('dlgConfirm').hide()" />
                        <p:commandButton value="No" onclick="PF('dlgConfirm').hide()"/>
                    </center>
                </h:panelGroup>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>

